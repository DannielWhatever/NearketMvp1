{"version":3,"sources":["controllers/theMap.controller.js"],"names":["angular","module","controller","$scope","$stateParams","$cordovaGeolocation","ItemFactory","BusquedaService","categories","category1","category2","category3","tooglers","options","timeout","enableHighAccuracy","getCurrentPosition","then","position","console","log","latLng","google","maps","LatLng","coords","latitude","longitude","mapOptions","center","zoom","mapTypeId","MapTypeId","ROADMAP","map","Map","document","getElementById","advancedSearch","getFrm","loadItems","itemId","error","buscar","resp","results","data","items","_","filter","item","seller_address","forEach","event","addListenerOnce","contentString","title","price","available_quantity","sold_quantity","condition","permalink","infowindow","InfoWindow","content","marker","Marker","animation","Animation","DROP","icon","category","addListener","open","setVisible","setZoom","failure","categToogle","categ","trigger"],"mappings":"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","file":"theMap.controller.js","sourcesContent":["angular.module('hackaton700.controllers')\n\n  .controller('TheMapController', function($scope,\n                                           $stateParams,\n                                           $cordovaGeolocation,ItemFactory,\n                                           BusquedaService\n  ) {\n\n\n\n    $scope.categories = {\n      category1: 'Desde $' + 0 + ' a $' + 10000,\n      category2 : 'Desde $' + 10000 + ' a $' + 100000,\n      category3: 'Desde $' + 100000 + ' a $' + 99999999\n    };\n\n\n    $scope.tooglers = {\n      category1 : true,\n      category2 : true,\n      category3 : true\n    };\n\n    var options = {timeout: 10000, enableHighAccuracy: true};\n\n    $cordovaGeolocation.getCurrentPosition(options).then(function(position) {\n\n      console.log(position);\n\n      var latLng = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);\n\n      var mapOptions = {\n        center: latLng,\n        zoom: 13,\n        mapTypeId: google.maps.MapTypeId.ROADMAP\n      };\n\n      $scope.map = new google.maps.Map(document.getElementById(\"map\"), mapOptions);\n\n      //console.log($stateParams);\n      var advancedSearch = BusquedaService.getFrm();\n      if(advancedSearch){\n        console.log(advancedSearch);\n        loadItems($stateParams.itemId, advancedSearch);\n      }else{\n        loadItems($stateParams.itemId);\n      }\n\n    }, function(error){\n        console.log(\"Could not get location\");\n    });\n\n\n\n\n    //private\n    function loadItems(itemId,advancedSearch) {\n      ItemFactory.buscar(itemId,'TUxDQ1NBTjk4M2M',advancedSearch).then(\n          resp=>{\n            console.log(resp);\n\n            var results = resp.data.items;\n            $scope.categories = resp.data.categories;\n\n            _.filter(results,item=>{\n              return item.seller_address && item.seller_address.latitude!=\"\" && item.seller_address.longitude!=null;\n            });\n\n\n            _.forEach(results, item => {\n              //console.log(item);\n\n\n              var latLng = new google.maps.LatLng(item.seller_address.latitude,item.seller_address.longitude);\n              //console.log(latLng);\n              new google.maps.event.addListenerOnce($scope.map, 'idle', function(){\n\n\n                var contentString =\n                  '<div id=\"content\">'+\n                    '<div id=\"bodyContent\">'+\n                       //'<img src=\"'+item.thumbnail+'\" /><br/>' +\n                      '<h3>'+item.title+'</h3>'+\n                      '<p>' +\n                        '<b>$'+ item.price+'</b><br/>'+\n                        '<span>Disponibles '+ item.available_quantity+' / Vendidos '+ item.sold_quantity+'</span><br/>'+\n                        '<span>'+ (item.condition=='new' ? 'Nuevo' : 'Usado') +'</span><br/>'+\n                      '</p>'+\n                      '<a href=\"'+item.permalink+'\" class=\"button button-energized\">Compra en ML</a>'+\n                    '</div>'+\n                  '</div>';\n\n                var infowindow = new google.maps.InfoWindow({\n                  content: contentString\n                });\n\n\n                var marker = new google.maps.Marker({\n                  map: $scope.map,\n                  animation: google.maps.Animation.DROP,\n                  position: latLng,\n                  icon: '/img/markers/'+item.category+'.png'\n                });\n\n                marker.addListener('click', function() {\n                  infowindow.open($scope.map, marker);\n                });\n\n                $scope.map.addListener('toogleOff'+item.category, () => {\n                  marker.setVisible($scope.tooglers[item.category]);\n                });\n\n\n              });\n\n              $scope.map.setZoom(12);\n\n            });\n\n\n\n\n        },failure=>{\n          console.error(failure);\n        });\n    }\n\n\n    $scope.categToogle = (categ) => {\n      $scope.tooglers[categ] = !$scope.tooglers[categ];\n      google.maps.event.trigger($scope.map,'toogleOff'+categ);\n    };\n\n  });\n"]}